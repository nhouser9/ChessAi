<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Board.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ChessAI</a> &gt; <a href="index.source.html" class="el_package">chessboard</a> &gt; <span class="el_source">Board.java</span></div><h1>Board.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package chessboard;

import chessboard.moves.GenericMove;
import chessboard.pieces.Bishop;
import chessboard.pieces.King;
import chessboard.pieces.Knight;
import chessboard.pieces.Pawn;
import chessboard.pieces.Piece;
import chessboard.pieces.Queen;
import chessboard.pieces.Rook;
import java.util.Collections;
import java.util.HashMap;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.Stack;

/**
 * Class representing the game board.
 *
 * @author Nick Houser
 */
public class Board {

    /**
     * The number of squares per one side of a chess board.
     */
    public static final int SQUARES_PER_SIDE = 8;

    /**
     * Method which checks whether a given co-ordinate is on the board.
     *
     * @param x the x co-ordinate to check
     * @param y the y co-ordinate to check
     * @return true if the passed position is within bounds, false otherwise
     */
    public static boolean inBounds(int x, int y) {
<span class="fc bfc" id="L43" title="All 2 branches covered.">        if (x &lt; 0) {</span>
<span class="fc" id="L44">            return false;</span>
        }

<span class="fc bfc" id="L47" title="All 2 branches covered.">        if (y &lt; 0) {</span>
<span class="fc" id="L48">            return false;</span>
        }

<span class="fc bfc" id="L51" title="All 2 branches covered.">        if (x &gt;= SQUARES_PER_SIDE) {</span>
<span class="fc" id="L52">            return false;</span>
        }

<span class="fc bfc" id="L55" title="All 2 branches covered.">        if (y &gt;= SQUARES_PER_SIDE) {</span>
<span class="fc" id="L56">            return false;</span>
        }

<span class="fc" id="L59">        return true;</span>
    }

    /**
     * Method which returns the pieces necessary to set up the pieces for a
     * normal game.
     *
     * @return a list of Pieces that are on a regularly setup chessboard
     */
    public static List&lt;Piece&gt; initialState() {
<span class="fc" id="L69">        List&lt;Piece&gt; initialPieces = new LinkedList&lt;&gt;();</span>

<span class="fc" id="L71">        initialPieces.add(new Rook(Color.WHITE, 0, Color.WHITE.homeRow()));</span>
<span class="fc" id="L72">        initialPieces.add(new Knight(Color.WHITE, 1, Color.WHITE.homeRow()));</span>
<span class="fc" id="L73">        initialPieces.add(new Bishop(Color.WHITE, 2, Color.WHITE.homeRow()));</span>
<span class="fc" id="L74">        initialPieces.add(new Queen(Color.WHITE, 3, Color.WHITE.homeRow()));</span>
<span class="fc" id="L75">        initialPieces.add(new King(Color.WHITE, 4, Color.WHITE.homeRow()));</span>
<span class="fc" id="L76">        initialPieces.add(new Bishop(Color.WHITE, 5, Color.WHITE.homeRow()));</span>
<span class="fc" id="L77">        initialPieces.add(new Knight(Color.WHITE, 6, Color.WHITE.homeRow()));</span>
<span class="fc" id="L78">        initialPieces.add(new Rook(Color.WHITE, 7, Color.WHITE.homeRow()));</span>

<span class="fc bfc" id="L80" title="All 2 branches covered.">        for (int col = 0; col &lt; SQUARES_PER_SIDE; col++) {</span>
<span class="fc" id="L81">            initialPieces.add(new Pawn(Color.WHITE, col, Color.WHITE.pawnRow()));</span>
<span class="fc" id="L82">            initialPieces.add(new Pawn(Color.BLACK, col, Color.BLACK.pawnRow()));</span>
        }

<span class="fc" id="L85">        initialPieces.add(new Rook(Color.BLACK, 0, Color.BLACK.homeRow()));</span>
<span class="fc" id="L86">        initialPieces.add(new Knight(Color.BLACK, 1, Color.BLACK.homeRow()));</span>
<span class="fc" id="L87">        initialPieces.add(new Bishop(Color.BLACK, 2, Color.BLACK.homeRow()));</span>
<span class="fc" id="L88">        initialPieces.add(new Queen(Color.BLACK, 3, Color.BLACK.homeRow()));</span>
<span class="fc" id="L89">        initialPieces.add(new King(Color.BLACK, 4, Color.BLACK.homeRow()));</span>
<span class="fc" id="L90">        initialPieces.add(new Bishop(Color.BLACK, 5, Color.BLACK.homeRow()));</span>
<span class="fc" id="L91">        initialPieces.add(new Knight(Color.BLACK, 6, Color.BLACK.homeRow()));</span>
<span class="fc" id="L92">        initialPieces.add(new Rook(Color.BLACK, 7, Color.BLACK.homeRow()));</span>

<span class="fc" id="L94">        return initialPieces;</span>
    }

    //the color whose turn it is
    private Color activePlayer;

    //the move history
    private Stack&lt;GenericMove&gt; moveHistory;
    //the array of pieces on the board

    private Piece[][] pieces;

    //links to both kings for easy retrieval
    private Map&lt;Color, King&gt; kings;

    //a list of possible moves from this position
    private List&lt;GenericMove&gt; possibleMoves;

    /**
     * Constructor which initializes the piece array to the initial chess board.
     * Defaults to the initial chess state if no list of pieces is passed in.
     *
     * @param initialPieces the initial pieces to add to the board
     * @param active the player whose turn it is
     */
<span class="fc" id="L119">    public Board(List&lt;Piece&gt; initialPieces, Color active) {</span>
<span class="fc" id="L120">        initializeFields(active);</span>
<span class="fc" id="L121">        setupPieces(initialPieces);</span>
<span class="fc" id="L122">    }</span>

    /**
     * Method which returns the player whose turn it is.
     *
     * @return the color whose turn it is
     */
    public Color activePlayer() {
<span class="fc" id="L130">        return activePlayer;</span>
    }

    /**
     * Method which changes control of the turn to the next player.
     */
    public void passTurn() {
<span class="fc" id="L137">        activePlayer = activePlayer.enemy();</span>
<span class="fc" id="L138">    }</span>

    /**
     * Method which returns the occupant of the given position.
     *
     * @param xPosition the x position to check
     * @param yPosition the y position to check
     * @return the Piece at the passed position
     */
    public Piece occupant(int xPosition, int yPosition) {
<span class="fc" id="L148">        return pieces[xPosition][yPosition];</span>
    }

    /**
     * Sets the occupant of the given position to the passed Piece.
     *
     * @param xPosition the x position to set
     * @param yPosition the y position to set
     * @param occupant the Piece to set in the position
     */
    public void setOccupant(int xPosition, int yPosition, Piece occupant) {
<span class="fc" id="L159">        pieces[xPosition][yPosition] = occupant;</span>
<span class="fc" id="L160">    }</span>

    /**
     * Helper method which locates the king of a specific color.
     *
     * @param color the color of king to locate
     * @return the requested King
     */
    public King findKing(Color color) {
<span class="fc bfc" id="L169" title="All 2 branches covered.">        if (kings.containsKey(color)) {</span>
<span class="fc" id="L170">            return kings.get(color);</span>
        }
<span class="fc" id="L172">        return null;</span>
    }

    /**
     * Method which returns a list of past moves made on the board.
     *
     * @return a list of past moves made on the board
     */
    public GenericMove lastMove() {
<span class="fc bfc" id="L181" title="All 2 branches covered.">        if (moveHistory.isEmpty()) {</span>
<span class="fc" id="L182">            return null;</span>
        }
<span class="fc" id="L184">        return moveHistory.peek();</span>
    }

    /**
     * Method which removes the most recent item of move history.
     */
    public void removeLastMove() {
<span class="fc" id="L191">        moveHistory.pop();</span>
<span class="fc" id="L192">    }</span>

    /**
     * Method which adds a move to the move history.
     *
     * @param move the move to add
     */
    public void addToHistory(GenericMove move) {
<span class="fc" id="L200">        moveHistory.add(move);</span>
<span class="fc" id="L201">    }</span>

    /**
     * Method which returns a list of possible moves from this board state.
     *
     * @return a list of possible moves from this board state
     */
    public List&lt;GenericMove&gt; validMoves() {
<span class="fc bfc" id="L209" title="All 2 branches covered.">        if (possibleMoves == null) {</span>
<span class="fc" id="L210">            possibleMoves = calculatePossibleMoves(activePlayer);</span>
        }
<span class="fc" id="L212">        return Collections.unmodifiableList(possibleMoves);</span>
    }

    /**
     * Method which resets the list of possible moves, which will force
     * recalculation.
     */
    public void resetValidMoves() {
<span class="fc" id="L220">        possibleMoves = null;</span>
<span class="fc" id="L221">    }</span>

    /**
     * Helper method which calculates the list of possible moves.
     *
     * @param player the player whose moves should be calculated
     * @return a list of possible moves in the current position
     */
    private List&lt;GenericMove&gt; calculatePossibleMoves(Color player) {
<span class="fc" id="L230">        List&lt;GenericMove&gt; toReturn = new LinkedList&lt;&gt;();</span>
<span class="fc bfc" id="L231" title="All 2 branches covered.">        for (int col = 0; col &lt; SQUARES_PER_SIDE; col++) {</span>
<span class="fc bfc" id="L232" title="All 2 branches covered.">            for (int row = 0; row &lt; SQUARES_PER_SIDE; row++) {</span>
<span class="fc" id="L233">                Piece occupant = occupant(col, row);</span>
<span class="fc bfc" id="L234" title="All 4 branches covered.">                if (occupant == null || occupant.color != player) {</span>
<span class="fc" id="L235">                    continue;</span>
                }
<span class="fc bfc" id="L237" title="All 2 branches covered.">                for (GenericMove target : occupant.validMoves(this)) {</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">                    if (target.endangersKing()) {</span>
<span class="fc" id="L239">                        continue;</span>
                    }
<span class="fc" id="L241">                    toReturn.add(target);</span>
<span class="fc" id="L242">                }</span>
            }
        }
<span class="fc" id="L245">        return toReturn;</span>
    }

    /**
     * Helper method which initializes fields to their default values.
     *
     * @param active the color whose turn it is
     */
    private void initializeFields(Color active) {
<span class="fc" id="L254">        pieces = new Piece[SQUARES_PER_SIDE][SQUARES_PER_SIDE];</span>
<span class="fc" id="L255">        activePlayer = active;</span>
<span class="fc" id="L256">        moveHistory = new Stack&lt;&gt;();</span>
<span class="fc" id="L257">        possibleMoves = null;</span>
<span class="fc" id="L258">        kings = new HashMap&lt;&gt;();</span>
<span class="fc" id="L259">    }</span>

    /**
     * Helper method which adds the inital pieces to the board.
     *
     * @param initialPieces the initial pieces to add
     */
    private void setupPieces(List&lt;Piece&gt; initialPieces) {
<span class="fc bfc" id="L267" title="All 2 branches covered.">        for (Piece piece : initialPieces) {</span>
<span class="fc" id="L268">            pieces[piece.position().x][piece.position().y] = piece;</span>
<span class="fc bfc" id="L269" title="All 2 branches covered.">            if (piece instanceof King) {</span>
<span class="fc" id="L270">                kings.put(piece.color, (King) piece);</span>
            }
<span class="fc" id="L272">        }</span>
<span class="fc" id="L273">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>